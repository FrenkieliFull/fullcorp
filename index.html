<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script type="text/javascript" src="instascan.min.js"></script>
  <!-- 載入instascan.min.js -->
</head>

<body>
  WebRTC 影像測試
  <br />問題：https://ithelp.ithome.com.tw/questions/10192363
  <hr />
  <video autoplay playsinline></video>
  <script>
    'use strict';

    var constraints = {
      video: true
    };

    var video = document.querySelector('video');

    function handleSuccess(stream) {
      window.stream = stream; // only to make stream available to console
      video.srcObject = stream;
    }

    function handleError(error) {
      console.log('getUserMedia error: ', error);
    }

    navigator.mediaDevices.getUserMedia(constraints).
      then(handleSuccess).catch(handleError);
  </script>
  <video id="preview"></video>
  <!-- 詢問是否允許開啟相機後，會顯示在這個元素裡 -->
  <!-- ---------- -->
  <!-- 以下程式面 -->
  <script type="text/javascript">
    let scanner = new Instascan.Scanner({
      video: document.getElementById('preview')
    });
    // 開啟一個新的掃描
    // 宣告變數scanner，在html<video>標籤id為preview的地方開啟相機預覽。
    // Notice:這邊注意一定要用<video>的標籤才能使用，詳情請看他的github API的部分解釋。

    scanner.addListener('scan', function (content) {
      console.log(content);
    });
    //開始偵聽掃描事件，若有偵聽到印出內容。

    Instascan.Camera.getCameras().then(function (cameras) {
      //取得設備的相機數目
      if (cameras.length > 0) {
        ///若設備相機數目大於0 則先開啟第0個相機(程式的世界是從第零個開始的)
        scanner.start(cameras[0]);
      } else {
        //若設備沒有相機數量則顯示"No cameras found";
        //這裡自行判斷要寫什麼
        console.error('No cameras found.');
      }
    }).catch(function (e) {
      console.error(e);
    });
  </script>
</body>

</html>